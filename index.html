<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>test</title>
</head>
<style>
  #bottomNav{
    position:fixed;
    bottom:0px;
    left:0px;
    width:100vw;
  }

</style>
<body>
    <?!= include('Math_Equation_Component'); ?>
    <?!= include('pngConverter'); ?>
    <p>testing this out<p/>
    <math-equation-component id="mathComponent"></math-equation-component>
    <div id="bottomNav">
      <button id="bindImage">bind image</button>  
    </div>
    <script>
      /*Globals*/
      let imageIdBind = ""
      let imageBinded = false;

      var error = function(error){
        console.log("[ERROR]----------------------------")
        console.log(error)
        console.log("[End ERROR]----------------------------")
      }

      //Grab image from slideshow and put it into component

      document.getElementById("bindImage").addEventListener("click",function(){
        console.log("-----------------------CLicked")

        
        let button = document.getElementById("bindImage");
        let mathComponent = document.getElementById("mathComponent");

        if(!imageBinded){
          google.script.run.withSuccessHandler(function(results){
            console.log(results);
            imageIdBind = results["id"]
            
            imageBinded = !imageBinded;
            button.innerText = "binded";

          }).withFailureHandler(error).loadImage();
        }
        else
        {
          button.innerText = "bind image";
        }

        
      })


      //take component out and put it into slideshow

      const convert_blobToBase64String = async (blob) =>  {
          const base64url = await new Promise((r) => {
          const reader = new FileReader()
          reader.onload = () => r(reader.result)
          reader.readAsDataURL(blob);
        })
        return base64url;
      }

      document.getElementById("mathComponent").addEventListener("math-equation-gen-image",function(mathData){
        console.log("got a event")
        console.log(mathData.detail)
        
        let imageBlob = mathData.detail.blob;
        let imageData = mathData.detail.equationProps;

        

        convert_blobToBase64String(imageBlob).then(function(blobString){
          console.log(blobString.split("base64,"))
          console.log("got here-------------")
          google.script.run.withSuccessHandler(function(results){

          }).withFailureHandler(error).addImage(blobString.split("base64,")[1], imageData, imageIdBind);
        })
      })

    </script>
</body>
</html>